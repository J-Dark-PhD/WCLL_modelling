import matplotlib.pyplot as plt
import numpy as np
from scipy.stats import linregress

x_1 = np.linspace(0.028, 0.15, num=100)
x_2 = np.linspace(0.15, 0.6, num=100)
x = np.linspace(0.028, 0.60, num=200)
lipb_power = 3.9108e05 * x_1 ** (-1.213) / 1e06
lipb_power_2 = 8.4629e06 * np.exp(-5.485 * x_2) / 1e06

data = np.genfromtxt("power_density.csv", delimiter=",", names=True)
data_r = data["x"]
data_q = data["q"]
power_dist_data = [
    (0.02538407189793082, 9.659691894226619),
    (0.031965976933908014, 9.02225617891251),
    (0.034676867936080796, 8.6827554062485),
    (0.03818543845641681, 8.35391969167273),
    (0.040898755023860506, 8.03073379085281),
    (0.04432702442492867, 7.713443969861306),
    (0.04770834573115135, 7.383335029034889),
    (0.051089667037374, 7.053226088208479),
    (0.054471563826427205, 6.7156780726592125),
    (0.05789941703009113, 6.40376829677977),
    (0.06136089808482517, 6.044475932235926),
    (0.06517045116941983, 5.6968347970757165),
    (0.06815401119894429, 5.365772128720732),
    (0.07205375123292382, 5.00794548159524),
    (0.07581471136892184, 4.650521188270865),
    (0.08232768692122258, 4.40318855881365),
    (0.0889712009607524, 4.237919199162125),
    (0.09419865849289014, 4.02951570876467),
    (0.10036966455636662, 3.904289005135098),
    (0.10499971616547835, 3.699423861400394),
    (0.11117047230649396, 3.577427822115073),
    (0.11607290052113284, 3.385762249844028),
    (0.12302858165554922, 3.2667370542784475),
    (0.1324863272583881, 3.0133435715314114),
    (0.13973625096567843, 2.8864143590728055),
    (0.14782228071017398, 2.744827232933325),
    (0.15478591897399882, 2.6827606312198213),
    (0.1669341450200794, 2.389856121322648),
    (0.17402157575501373, 2.291789088197401),
    (0.1816694482919677, 2.2011741351703904),
    (0.1890591383044907, 2.1111444240359134),
    (0.19644902450434235, 2.018578664700467),
    (0.20383891070419394, 1.9260129053650203),
    (0.21122850262305262, 1.83725121833103),
    (0.2186182907292399, 1.7459534830960663),
    (0.22600798074176295, 1.6559237719615894),
    (0.23339619934932151, 1.5849144223343963),
    (0.24078363320756566, 1.5240492655110884),
    (0.2481713613468027, 1.459380036386321),
    (0.2555590894860398, 1.3947108072615606),
    (0.26294691571894113, 1.3287735540363101),
    (0.2703345457645139, 1.2653723490120292),
    (0.2777216853417651, 1.2083112644901775),
    (0.28510823635703064, 1.1588583245712378),
    (0.29249449309130326, 1.1132094569537578),
    (0.2998807498255759, 1.0675605893362778),
    (0.3072671046535127, 1.0206436976183113),
    (0.314653263294121, 0.9762628541013143),
    (0.32203952002839364, 0.9306139864838343),
    (0.32942528629434475, 0.8913052393687799),
    (0.33681066018563866, 0.8570685886556717),
    (0.34419593598326825, 0.8240999620430429),
    (0.35158111368723366, 0.7923993595309042),
    (0.35896638948486326, 0.759430732918279),
    (0.36635146909516425, 0.7289981545066269),
    (0.37373654870546524, 0.6985655760949712),
    (0.38112123594110914, 0.6732050940852581),
    (0.38850562889576, 0.6516486843770046),
    (0.3958901199440753, 0.6288242505682646),
    (0.4032749052733834, 0.6021957444580686),
    (0.4106592001343702, 0.5819073588502981),
    (0.41804398546367827, 0.5552788527400985),
    (0.42542857460565786, 0.5311863948308719),
    (0.4328125751856515, 0.5147020815245611),
    (0.4401969681403024, 0.4931456718163041),
    (0.4475812630012892, 0.4728572862085336),
    (0.45496506739395426, 0.4589090211031923),
    (0.46234926416127664, 0.43988865959591195),
    (0.469733460928599, 0.420868298088628),
    (0.4771169710402713, 0.4107241052847428),
    (0.48450126590125786, 0.3904357196769759),
    (0.49188448173193733, 0.3840955991745467),
    (0.4992679918436095, 0.3739514063706615),
    (0.5066520905172677, 0.3561990689638641),
    (0.5140354044416112, 0.3485909243609484),
    (0.5214186202722906, 0.3422508038585228),
    (0.5288014437283128, 0.34098277975803626),
    (0.5361851500273137, 0.3283025387531815),
    (0.5435678753896716, 0.3283025387531815),
    (0.5509506007520295, 0.3283025387531815),
    (0.5583340127700374, 0.31942637004977925),
    (0.562696924676997, 0.31435427364783664),
    (0.591894307667817, 0.28772576753764056),
    (0.5992781120604822, 0.27377750243229926),
    (0.6066609355165045, 0.2725094783318127),
    (0.6140436608788623, 0.2725094783318127),
    (0.6214270728968703, 0.263633309628414),
    (0.6288101906338853, 0.2585612132264714),
    (0.6361929159962432, 0.2585612132264714),
    (0.6435756413586011, 0.2585612132264714),
    (0.6509586610019519, 0.25475714092501534),
    (0.6583421711136241, 0.2446129481211301),
    (0.6657248964759821, 0.2446129481211301),
    (0.6731076218383399, 0.2446129481211301),
    (0.6804903472006979, 0.2446129481211301),
    (0.6878730725630557, 0.2446129481211301),
    (0.6952556998317493, 0.24588097222161664),
    (0.702639013756093, 0.23827282761870094),
    (0.7100223276804366, 0.2306646830157888),
    (0.7174050530427944, 0.2306646830157888),
    (0.7247877784051524, 0.2306646830157888),
    (0.7321705037675103, 0.2306646830157888),
    (0.7395532291298682, 0.2306646830157888),
    (0.746935954492226, 0.2306646830157888),
    (0.7543196607912269, 0.21798444201093403),
    (0.7617024842472492, 0.2167164179104475),
    (0.769085209609607, 0.2167164179104475),
    (0.7764679349719649, 0.2167164179104475),
    (0.7815016113553908, 0.2167164179104475),
]
power_dist_data_front = [
    (0.02538407189793082, 9.659691894226619),
    (0.031965976933908014, 9.02225617891251),
    (0.034676867936080796, 8.6827554062485),
    (0.03818543845641681, 8.35391969167273),
    (0.040898755023860506, 8.03073379085281),
    (0.04432702442492867, 7.713443969861306),
    (0.04770834573115135, 7.383335029034889),
    (0.051089667037374, 7.053226088208479),
    (0.054471563826427205, 6.7156780726592125),
    (0.05789941703009113, 6.40376829677977),
    (0.06136089808482517, 6.044475932235926),
    (0.06517045116941983, 5.6968347970757165),
    (0.06815401119894429, 5.365772128720732),
    (0.07205375123292382, 5.00794548159524),
    (0.07581471136892184, 4.650521188270865),
    (0.08232768692122258, 4.40318855881365),
    (0.0889712009607524, 4.237919199162125),
    (0.09419865849289014, 4.02951570876467),
    (0.10036966455636662, 3.904289005135098),
    (0.10499971616547835, 3.699423861400394),
    (0.11117047230649396, 3.577427822115073),
    (0.11607290052113284, 3.385762249844028),
    (0.12302858165554922, 3.2667370542784475),
    (0.1324863272583881, 3.0133435715314114),
    (0.13973625096567843, 2.8864143590728055),
    (0.14782228071017398, 2.744827232933325),
    (0.15478591897399882, 2.6827606312198213),
]
power_dist_data_rear = [
    (0.1669341450200794, 2.389856121322648),
    (0.17402157575501373, 2.291789088197401),
    (0.1816694482919677, 2.2011741351703904),
    (0.1890591383044907, 2.1111444240359134),
    (0.19644902450434235, 2.018578664700467),
    (0.20383891070419394, 1.9260129053650203),
    (0.21122850262305262, 1.83725121833103),
    (0.2186182907292399, 1.7459534830960663),
    (0.22600798074176295, 1.6559237719615894),
    (0.23339619934932151, 1.5849144223343963),
    (0.24078363320756566, 1.5240492655110884),
    (0.2481713613468027, 1.459380036386321),
    (0.2555590894860398, 1.3947108072615606),
    (0.26294691571894113, 1.3287735540363101),
    (0.2703345457645139, 1.2653723490120292),
    (0.2777216853417651, 1.2083112644901775),
    (0.28510823635703064, 1.1588583245712378),
    (0.29249449309130326, 1.1132094569537578),
    (0.2998807498255759, 1.0675605893362778),
    (0.3072671046535127, 1.0206436976183113),
    (0.314653263294121, 0.9762628541013143),
    (0.32203952002839364, 0.9306139864838343),
    (0.32942528629434475, 0.8913052393687799),
    (0.33681066018563866, 0.8570685886556717),
    (0.34419593598326825, 0.8240999620430429),
    (0.35158111368723366, 0.7923993595309042),
    (0.35896638948486326, 0.759430732918279),
    (0.36635146909516425, 0.7289981545066269),
    (0.37373654870546524, 0.6985655760949712),
    (0.38112123594110914, 0.6732050940852581),
    (0.38850562889576, 0.6516486843770046),
    (0.3958901199440753, 0.6288242505682646),
    (0.4032749052733834, 0.6021957444580686),
    (0.4106592001343702, 0.5819073588502981),
    (0.41804398546367827, 0.5552788527400985),
    (0.42542857460565786, 0.5311863948308719),
    (0.4328125751856515, 0.5147020815245611),
    (0.4401969681403024, 0.4931456718163041),
    (0.4475812630012892, 0.4728572862085336),
    (0.45496506739395426, 0.4589090211031923),
    (0.46234926416127664, 0.43988865959591195),
    (0.469733460928599, 0.420868298088628),
    (0.4771169710402713, 0.4107241052847428),
    (0.48450126590125786, 0.3904357196769759),
    (0.49188448173193733, 0.3840955991745467),
    (0.4992679918436095, 0.3739514063706615),
    (0.5066520905172677, 0.3561990689638641),
    (0.5140354044416112, 0.3485909243609484),
    (0.5214186202722906, 0.3422508038585228),
    (0.5288014437283128, 0.34098277975803626),
    (0.5361851500273137, 0.3283025387531815),
    (0.5435678753896716, 0.3283025387531815),
    (0.5509506007520295, 0.3283025387531815),
    (0.5583340127700374, 0.31942637004977925),
    (0.562696924676997, 0.31435427364783664),
    (0.591894307667817, 0.28772576753764056),
    (0.5992781120604822, 0.27377750243229926),
    (0.6066609355165045, 0.2725094783318127),
    (0.6140436608788623, 0.2725094783318127),
    (0.6214270728968703, 0.263633309628414),
    (0.6288101906338853, 0.2585612132264714),
    (0.6361929159962432, 0.2585612132264714),
    (0.6435756413586011, 0.2585612132264714),
    (0.6509586610019519, 0.25475714092501534),
    (0.6583421711136241, 0.2446129481211301),
    (0.6657248964759821, 0.2446129481211301),
    (0.6731076218383399, 0.2446129481211301),
    (0.6804903472006979, 0.2446129481211301),
    (0.6878730725630557, 0.2446129481211301),
    (0.6952556998317493, 0.24588097222161664),
    (0.702639013756093, 0.23827282761870094),
    (0.7100223276804366, 0.2306646830157888),
    (0.7174050530427944, 0.2306646830157888),
    (0.7247877784051524, 0.2306646830157888),
    (0.7321705037675103, 0.2306646830157888),
    (0.7395532291298682, 0.2306646830157888),
    (0.746935954492226, 0.2306646830157888),
    (0.7543196607912269, 0.21798444201093403),
    (0.7617024842472492, 0.2167164179104475),
    (0.769085209609607, 0.2167164179104475),
    (0.7764679349719649, 0.2167164179104475),
    (0.7815016113553908, 0.2167164179104475),
]

power_dist_data_front = np.array(power_dist_data_front)
res_lf = linregress(
    np.log10(power_dist_data_front[:, 0]), np.log10(power_dist_data_front[:, 1])
)
q_1 = 10 ** (res_lf.intercept) * x_1**res_lf.slope

power_dist_data_rear = np.array(power_dist_data_rear)
power_dist_data_rear_x_values = power_dist_data_rear[:, 0]
power_dist_data_rear_logy_values = np.log(power_dist_data_rear[:, 1])
res_lb = linregress(power_dist_data_rear_x_values, power_dist_data_rear_logy_values)
q_2 = np.exp(res_lb.intercept) * np.exp(x_2 * res_lb.slope)

power_dist_data = np.array(power_dist_data)
res = linregress(np.log10(power_dist_data[:, 0]), np.log10(power_dist_data[:, 1]))
q = 10 ** (res.intercept) * x**res.slope


plt.figure()
plt.plot(x_1, lipb_power, color="black")
plt.plot(x_2, lipb_power_2, color="black")
plt.scatter(data_r, data_q, color="blue")

plt.plot(
    x_1,
    q_1,
    color="tab:red",
    label="Front : {:.4e} x ^ {:.4}".format(10**res_lf.intercept, res_lf.slope),
)
plt.plot(
    x_2,
    q_2,
    color="red",
    label="Rear : {:.4e} exp ({:.4}*x)".format(np.exp(res_lb.intercept), res_lb.slope),
)

# plt.plot(
#     x,
#     q,
#     color="red",
#     label="power : {:.4e} x ^ {:.4}".format(10**res.intercept, res.slope),
# )

plt.ylabel("Power density [MW/m3]")
plt.xlabel("Radial length")
plt.xlim(0, 0.6)
plt.ylim(0, 27)
plt.yticks([27, 24, 21, 18, 15, 12, 9, 6, 3])
plt.grid()
plt.legend()
plt.show()
